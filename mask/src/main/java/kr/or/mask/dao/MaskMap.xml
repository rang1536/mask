<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mask">

<!-- login -->
<select id="login" parameterType="Map" resultType="kr.or.mask.domain.User">
	SELECT *
	  FROM MEMBER
	 WHERE ID = #{id}
	   AND PASS = #{pass} 
</select>

<!-- 일반공지 조회 -->
<select id="getNoticeList" parameterType="int" resultType="kr.or.mask.domain.Notice">
	SELECT *
	  FROM NOTICE
	 LIMIT #{startRow}, 10
</select>

<!-- 공지 총 카운트 조회 -->
<select id="getNoticeCnt" resultType="int">
	SELECT COUNT(*)
	  FROM NOTICE
	 WHERE TYPE = 1
</select>

<!-- =========================================================================================== -->
<!-- 조직도  -->
	<!-- 공통 -->
		<!-- 내정보 조회 -->
		<select id="getMyInfo" parameterType="String" resultType="kr.or.mask.domain.User">
			SELECT ID, PASS, NAME, PHONE, ZIPCODE, ADDR1, ADDR2, POINT
				   , DELIVERY_ZIPCODE, DELIVERY_ADDR1, DELIVERY_ADDR2
				   , RECOMMENDER, SPONSOR, AGENT, GRADE
				   , REGDATE, REGID, MODDATE, MODID, TREENO, PARENTID, SPON_GIVE_YN
			  FROM MEMBER
			 WHERE ID= #{id}
		</select>
		
		<!-- 센터조회 -->
		<select id="getUpAgentNm" parameterType="String" resultType="kr.or.mask.domain.Agent">
			SELECT CODE, NAME, REGDATE, REGID, MODDATE, MODID
			  FROM AGENT
			 WHERE CODE = #{agent}
		</select>
	
		
<!-- 후원조직도 조회 -->
		
	<!-- 하위 후원인 조회 -->
	<select id="getUnderTreeSponsor" parameterType="String" resultType="kr.or.mask.domain.User">
		SELECT ID, PASS, NAME, PHONE, ZIPCODE, ADDR1, ADDR2, POINT
			   , DELIVERY_ZIPCODE, DELIVERY_ADDR1, DELIVERY_ADDR2
			   , RECOMMENDER, SPONSOR, AGENT, GRADE
			   , REGDATE, REGID, MODDATE, MODID, TREENO, PARENTID, SPON_GIVE_YN
		  FROM MEMBER
		 WHERE SPONSOR = #{id} 
		 ORDER BY REGDATE
	</select>


<!-- 추천조직도 조회 -->
	
	<!-- 하위 추천인 조회 -->
	<select id="getUnderTreeRecommender" parameterType="String" resultType="kr.or.mask.domain.User" >
		SELECT ID, PASS, NAME, PHONE, ZIPCODE, ADDR1, ADDR2, POINT
			   , DELIVERY_ZIPCODE, DELIVERY_ADDR1, DELIVERY_ADDR2
			   , RECOMMENDER, SPONSOR, AGENT, GRADE
			   , REGDATE, REGID, MODDATE, MODID, TREENO, REPARENTID
		  FROM MEMBER
		 WHERE RECOMMENDER = #{id}
	</select>
	
<!-- ========================================================== -->
<!-- 						일 정 산 								-->
<!-- ========================================================== -->

	<!-- 전체회원 조회 -->
	<select id="getAllUser" resultType="kr.or.mask.domain.User">
		SELECT ID, NAME, PHONE, RECOMMENDER, SPONSOR, AGENT, GRADE
			   , REGDATE, REGID, MODDATE, MODID, TREENO, PARENTID
			   , REPARENTID, SPON_GIVE_YN
		  FROM MEMBER
	</select>
	
	<!-- 일정산데이터 생성 -->
	<insert id="setDayClosingTargetUser" parameterType="kr.or.mask.domain.DayClosing">
		INSERT INTO DAYCLOSING(
			USERID, REGDATE, LEFTCNT, RIGHTCNT, STATE, MODDATE)
		VALUES(
			#{id}, NOW(), #{leftCnt}, #{rightCnt}, #{state}, NOW()
			)
	</insert>
	
	<!-- 상대에게 후원보너스 받았는지 여부 체크 -->
	<select id="chkSponBonusYn" parameterType="Map" resultType="int">
		SELECT COUNT(*)
		  FROM POINT_HISTORY
		 WHERE FROM_ID = #{fromId}
		   AND TO_ID = #{toId}
		   AND TYPE = '09'
	</select>
	


</mapper>